---
layout: page
title: Chapter 3
permalink: /ch3/
nav_order: 3

---

## Chapter 3: Sequential Logic Design

在数字设计与计算机体系结构中，**顺序逻辑设计**（Sequential Logic Design）是一个关键概念，它与组合逻辑不同，后者的输出只依赖于当前的输入。而顺序逻辑的输出不仅取决于当前输入，还取决于之前的输入，这一特性使其能够具有**记忆**功能。通过这种记忆功能，顺序逻辑能够保存状态，并根据外部信号的变化进行决策。这是大多数现代计算机系统和电子设备的核心工作原理。

本章将详细探讨顺序逻辑设计的各个方面，介绍其基本构建模块——**状态元件**，并阐述如何通过这些元件构建同步顺序逻辑和有限状态机（Finite State Machines, FSMs）。另外，章节内容还涵盖了顺序逻辑的时序分析，探讨时钟偏斜、同步化及并行性等问题。

## Chapter 3: Topics

### 1. 状态元件（State Elements）
状态元件是顺序逻辑设计的基础，负责存储和维持电路的状态。本节将介绍不同类型的状态元件，包括：
- **双稳态电路**（Bistable Circuit）：最简单的存储元件，具有两个稳定状态。
- **SR锁存器**（SR Latch）：通过两个输入控制设定（Set）和复位（Reset）的简单存储单元。
- **D锁存器**（D Latch）：在时钟信号的作用下进行数据的存储。
- **D触发器**（D Flip-Flop）：在时钟边沿捕获输入信号的状态元件，用于同步电路设计。
- **状态元件的变种**（Variations）：探讨不同锁存器和触发器的变种及其应用。

### 2. 同步顺序逻辑（Synchronous Sequential Logic）
同步顺序逻辑是使用时钟信号控制状态变化的电路设计方法，确保系统的所有部分都根据统一的时钟信号进行协调。这部分内容将详细解释同步电路的工作原理及其优势。

### 3. 有限状态机（Finite State Machines）
有限状态机是顺序逻辑电路的一个重要应用，通过定义状态和状态转移规则来控制系统行为。本节将介绍以下几种状态机模型：
- **摩尔状态机**（Moore FSM）：输出只与当前状态有关的状态机。
- **米利状态机**（Mealy FSM）：输出不仅与当前状态有关，还取决于当前输入。
- **分解状态机**（Factored FSM）：将复杂状态机分解为多个较小的状态机，简化设计。

### 4. 顺序逻辑的时序分析（Timing of Sequential Logic）
时序分析是顺序逻辑设计中至关重要的一环，它决定了电路的正确性和速度。时钟信号的偏斜（Clock Skew）和信号的同步化（Synchronization）是时序分析中的两个重要问题。本节将讨论如何在设计中应对这些挑战。

### 5. 并行性（Parallelism）
现代系统中，并行计算和数据处理已成为提高性能的关键手段。在顺序逻辑设计中，并行性可以通过多种方法实现，减少时延并提高计算效率。

## Chapter 3: Sequential Logic - State Elements

### Introduction

顺序逻辑的输出依赖于当前的输入和之前的输入值，这一特性使得顺序逻辑具备**记忆**功能。与组合逻辑不同，顺序逻辑电路中的状态会随着时间的推移而发生变化，从而能够处理更复杂的任务，例如计数器、寄存器、甚至是复杂的控制系统。理解状态元件是理解整个顺序逻辑设计的第一步。





## Sequential Circuits

顺序电路是一类能够对事件赋予顺序的电路。与组合逻辑电路不同，顺序电路具有短期记忆能力，它可以记住之前的输入状态，并将输出反馈回输入端来存储信息。这一反馈机制使顺序电路能够根据先前的状态及当前的输入做出决定，广泛应用于寄存器、计数器和状态机等。

顺序电路的核心功能包括：
- **赋予事件顺序**：使电路能够按照时序依次处理数据。
- **具有短期记忆**：能记住之前的输入状态，这种记忆通常是暂时的。
- **使用反馈机制**：通过将输出反馈到输入来存储和保持状态。

## State Elements

在顺序电路中，**状态元件**用于存储和维持电路的状态。状态代表的是与之前输入相关的所有信息，这些信息足以预测电路的未来行为。通常，状态元件存储的信息量较少，比如一个位元（bit），它存储的是之前捕获的最后一个值。

典型的状态元件包括：
- **双稳态电路**（Bistable Circuit）：这是最基础的状态元件，能存储两个稳定状态。
- **SR锁存器**（SR Latch）：通过输入的设定（Set）和复位（Reset）来控制存储状态。
- **D锁存器**（D Latch）：存储数据，通常由时钟信号控制。
- **D触发器**（D Flip-Flop）：在时钟边沿触发时存储输入数据。

这些状态元件的主要任务是存储状态，并在顺序电路的操作过程中保持和更新这些状态。

## Bistable Circuit

### Introduction to Bistable Circuit

**双稳态电路**是所有其他状态元件的基本构建模块，它具有两个输出：`Q` 和 `Q̅`（Q的反相），没有外部输入。双稳态电路可以稳定在两个不同的状态（0或1），并通过反馈保持在某一个状态上，直到一个外部的触发事件导致状态的切换。这种电路的简单结构和可靠性使其成为存储位元信息的基础。

### Bistable Circuit Analysis

双稳态电路可以通过分析其两种可能状态来理解其工作原理。根据输出`Q`的值，电路可以处于以下两种情况之一：

- **当 Q = 0 时**：
  - 电路处于一种状态，输出`Q`为0，`Q̅`为1。
  - 这种状态会通过电路中的反馈机制保持不变，直到外部条件变化。

- **当 Q = 1 时**：
  - 电路处于另一种状态，输出`Q`为1，`Q̅`为0。
  - 这一状态同样会通过反馈回路保持稳定，直到发生切换。

通过这种分析，可以看出双稳态电路是如何通过反馈机制来稳定在两个状态之一，从而存储一个位的信息。这种电路的特性使其成为构建锁存器、触发器等更复杂状态元件的基础。





## SR Latch

### Introduction to SR Latch

**SR锁存器**（Set/Reset Latch）是一种基础的存储元件，广泛用于顺序逻辑电路中。它可以通过两个输入端`S`（Set）和`R`（Reset）来控制输出的状态，并具有记忆功能。SR锁存器的主要任务是存储一个位元的信息，这个信息可以是设定状态或复位状态，并保持不变，直到输入发生变化。

SR锁存器是双稳态电路的具体实现形式，它使用两个交叉耦合的逻辑门（通常为NAND门或NOR门）来构成。这些逻辑门形成一个反馈环路，确保输出状态能够维持在设定值。

### SR Latch Structure

SR锁存器的核心结构如图所示，由两个逻辑门`N1`和`N2`构成。输入端`S`用于设定输出，而输入端`R`用于复位输出。SR锁存器的输出为`Q`和`Q̅`（Q的反相），通过交叉反馈，这些输出状态能保持稳定。

### Four Possible Input Cases

根据输入`S`和`R`的不同组合，SR锁存器可以有四种可能的状态：

1. **S = 1, R = 0**（设定）：
   - 当`S = 1`且`R = 0`时，锁存器进入设定状态，输出`Q = 1`，`Q̅ = 0`。这意味着SR锁存器已存储1的状态。

2. **S = 0, R = 1**（复位）：
   - 当`S = 0`且`R = 1`时，锁存器进入复位状态，输出`Q = 0`，`Q̅ = 1`。此时，SR锁存器存储了0的状态。

3. **S = 0, R = 0**（保持）：
   - 当`S = 0`且`R = 0`时，锁存器保持当前状态，输出保持不变。如果之前输出为`Q = 1`，则仍然为`Q = 1`，如果之前为`Q = 0`，则保持`Q = 0`。这是SR锁存器的记忆功能，它能够维持之前的状态。

4. **S = 1, R = 1**（无效状态）：
   - 当`S = 1`且`R = 1`时，锁存器进入无效状态，因为`Q`和`Q̅`同时为1违反了电路的逻辑关系。这种情况应当避免。

### SR Latch Analysis

#### Case 1: S = 1, R = 0
当`S = 1`且`R = 0`时，锁存器会进入设定状态，输出`Q = 1`，`Q̅ = 0`。逻辑门N1的输出为0，N2的输出为1，反馈回路确保锁存器维持这一状态。

#### Case 2: S = 0, R = 1
当`S = 0`且`R = 1`时，锁存器进入复位状态，输出`Q = 0`，`Q̅ = 1`。这种情况下，N1输出1，N2输出0，电路保持该复位状态。

#### Case 3: S = 0, R = 0
当`S = 0`且`R = 0`时，SR锁存器进入保持状态，保持之前的输出状态。如果之前`Q = 0`，那么输出保持为0；如果之前`Q = 1`，则保持为1。这一状态展现了SR锁存器的记忆功能。

#### Case 4: S = 1, R = 1
当`S = 1`且`R = 1`时，SR锁存器进入不稳定状态，因为`Q`和`Q̅`都被驱动为1，这是一种无效状态。为了避免这一情况，电路设计必须确保输入`S`和`R`不会同时为1。

### SR Latch Functionality

- **设定状态**（Set）：当`S = 1, R = 0`时，锁存器输出`Q = 1`。
- **复位状态**（Reset）：当`S = 0, R = 1`时，锁存器输出`Q = 0`。
- **保持状态**（Memory）：当`S = 0, R = 0`时，锁存器保持之前的输出状态。
- **无效状态**：当`S = 1, R = 1`时，锁存器进入无效状态，需避免此输入组合。

设计电路时，必须确保输入信号不会同时触发设定和复位操作，以防止无效状态的出现。这通常通过额外的逻辑电路进行防护。



## D Latch

### Introduction to D Latch

**D锁存器**（D Latch）是一种常用的顺序逻辑电路元件，它通过时钟信号和数据输入来控制输出。D锁存器的设计旨在解决SR锁存器在输入信号`S`和`R`同时为1时出现的无效状态问题。通过将输入简化为单个数据输入`D`，D锁存器确保了其在任何输入条件下都能正常工作。

D锁存器具有两个输入：
- **时钟信号（CLK）**：控制输出何时发生变化。只有当时钟信号有效时，D锁存器才会根据输入数据`D`改变输出。
- **数据输入（D）**：决定输出的状态，即输出`Q`将随`D`输入而改变。

当时钟信号为高电平时，D锁存器将根据数据输入`D`的值改变输出。当时钟信号为低电平时，输出保持不变。这样可以确保在时钟信号的控制下，电路同步地存储和更新数据。

### D Latch Internal Circuit

D锁存器的内部电路结构包括两个逻辑门和一个反相器。其主要工作过程如下：
- 当时钟信号为高时，数据输入`D`决定了锁存器的输出。如果`D = 1`，则输出`Q = 1`；如果`D = 0`，则输出`Q = 0`。
- 当时钟信号为低时，锁存器保持之前的输出状态，不受数据输入的影响。

D锁存器的电路图展示了输入`CLK`和`D`如何通过交叉连接的RS锁存器来控制输出。这里的`S`和`R`信号由数据输入`D`和其反相信号`D̅`生成，这种结构使得锁存器能够根据`D`的值设置或复位输出。

### D Latch Functionality Table

D锁存器的功能可以通过一个真值表来表示，展示了不同输入条件下的输出变化：

| CLK  | D    | D̅    | S    | R    | Q     | Q̅     |
| ---- | ---- | ---- | ---- | ---- | ----- | ----- |
| 0    | X    | X    | 0    | 0    | Qprev | Qprev̅ |
| 1    | 0    | 1    | 0    | 1    | 0     | 1     |
| 1    | 1    | 0    | 1    | 0    | 1     | 0     |

从表中可以看出：
- 当时钟信号`CLK = 0`时，输出保持不变，即`Q`保持其先前的状态（`Qprev`）。
- 当时钟信号`CLK = 1`时，输出取决于数据输入`D`。如果`D = 0`，输出`Q = 0`；如果`D = 1`，输出`Q = 1`。

通过这种设计，D锁存器能够在时钟信号的控制下有效地存储数据，并避免了SR锁存器的无效状态问题。



## D Flip-Flop

### Introduction to D Flip-Flop

**D触发器**（D Flip-Flop）是顺序逻辑设计中一种重要的状态元件，主要用于时钟驱动的同步电路。与D锁存器（D Latch）不同，D触发器仅在时钟信号的特定边沿（上升沿或下降沿）采样输入数据，并将其存储在输出中。这种特性使得D触发器适用于需要高精度时序控制的电路，如寄存器、计数器和有限状态机（FSM）。

D触发器有两个主要输入：
- **CLK（时钟信号）**：控制数据何时从输入采样到输出。D触发器只在时钟的边沿（通常是上升沿）更新输出。
- **D（数据输入）**：控制要存储的数据。D触发器在时钟信号触发时，将数据输入的值传递到输出。

### D Flip-Flop Internal Circuit

D触发器的内部结构由两个背靠背连接的**D锁存器**（L1和L2）组成，它们分别由互补的时钟信号控制。其基本工作机制如下：

- **当 CLK = 0 时**：
  - 第一个D锁存器L1处于活动状态，输入`D`的数据通过L1锁存，但不会立即传递到输出`Q`。
  - 第二个D锁存器L2则处于锁定状态，不会更新输出。
  
- **当 CLK = 1 时**：
  - 第一个D锁存器L1锁定当前状态，不再接受输入数据。
  - 第二个D锁存器L2激活，将L1存储的数据传递到输出`Q`。

通过这种方式，D触发器只在时钟信号的边沿更新输出，确保数据同步且稳定。这种级联的设计使得D触发器能够防止信号传播时的亚稳态问题，提高了电路的时序控制能力。

### D Latch vs. D Flip-Flop

D锁存器和D触发器虽然都依赖于时钟信号和数据输入，但它们的行为在时序控制上有着显著的差异：

- **D锁存器**：
  - D锁存器在时钟信号为高电平时（而非特定边沿）会根据输入数据`D`更新输出`Q`。
  - 这种特性意味着D锁存器在时钟信号为高的整个持续时间内都是透明的，即输入`D`直接控制输出。

- **D触发器**：
  - D触发器则只在时钟信号的边沿（通常是上升沿）更新输出。它在时钟信号的非边沿期间锁定输出，避免了数据的意外更改。
  - 这种特性使得D触发器更加适合复杂时序要求的设计，尤其是在需要精确同步的情况下。

### Timing Diagram

从时序图中可以看出，D锁存器在时钟信号为高时会立即响应数据输入，而D触发器则仅在时钟的上升沿捕获数据并更新输出。这使得D触发器比D锁存器更加适合同步时序的电路设计。

